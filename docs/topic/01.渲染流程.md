


## 浏览器从输入url到页面渲染加载的过程 

主要流程:
- 解析url
- dns域名解析
- 建立tcp连接
- 发送http请求
- http缓存相关
- 页面渲染
  - pares html解析 构建dom-tree
  - css解析 构建cssom tree
  - 合成渲染树 构建 render tree (节点样式)
  - 布局 构建 layout tree (节点尺寸 位置)
  - 分层 对节点进行分层处理，使图层可以独立进行变换和光删除处理
  - 合并和渲染 COMPOSITE & RENDER：将上述不同的层合成为一张位图，发送给 GPU，渲染到屏幕上。


### 浏览器

多进程多线程架构
多进程:
- Browser进程：浏览器的主进程（负责协调、主控），只有一个。
- 第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建。
- GPU进程：最多一个，用于3D绘制等。
- 浏览器渲染进程（浏览器内核）（内部是多线程的）：默认每个Tab页面一个进程，互不影响。作用是页面渲染，脚本执行，事件处理等。（浏览器有时候会优化，如多个空白页合并成一个进程）

浏览器内核-多线程:
- GUI渲染线程：负责渲染浏览器界面，解析HTML，CSS，构建DOM树和RenderObject树，布局和绘制等。GUI渲染线程与JS引擎线程是互斥的。
- JS引擎线程：也叫 JS 内核，负责解析执行 JS 脚本程序的主线程，例如 V8 引擎。JS引擎一直等待着任务队列中任务的到来，然后加以处理，一个Tab页（renderer进程）中无论什么时候都只有一个JS线程在运行JS程序。
- 事件触发线程：属于浏览器内核线程，主要用于控制事件，例如鼠标、键盘等，当事件被触发时，就会把事件的处理函数推进事件队列，等待 JS 引擎线程执行。
- 定时器触发线程：主要控制 setInterval和 setTimeout，用来计时，计时完毕后，则把定时器的处理函数推进事件队列中，等待 JS 引擎线程。
- 异步http请求线程：通过XMLHttpRequest连接后，通过浏览器新开的一个线程，监控readyState状态变更时，如果设置了该状态的回调函数，则将该状态的处理函数推进事件队列中，等待JS引擎线程执行。

### URL 解析

解析url后进行处理，如：
- 添加 https 协议
- 直接进行搜索引擎搜索

### dns 域名解析

DNS 域名解析系统: 将易于记忆的域名转换为服务器可识别的IP地址  

解析流程及多级缓存策略:
- 浏览器缓存
- 操作系统缓存
- 本地dns服务器缓存
  - 本地DNS服务器获取流程
    - 请求根域名 ->顶级域名地址
    - 请求顶级域名 -> 权威域名地址

> 请求流程为UDP协议


### 建立 TCP 连接

拿到 IP 后， 通过三次握手建立tcp连接

1. 客户端发起请求， 包含 syn 标志位1 随机序列号 seq 客户端进入`SYN_SENT`状态
2. 服务端接收，开启一个socket端口， 返回syn=1 ACK=1 随机序列号 确认号seq+1 进入`SYN_RCVD`等待
3. 客户端根据 控制位为ack=1, 确认序列号为ack+1, 进入连接状态，服务端接收到后也进入连接状态

### 发送http请求

主要内容:
- 请求报文组成
- 常见状态码
- 请求/响应头
- 请求/响应体
- cookie以及优化
  - 安全
  - 多域名拆分提测
  - dns-prefetch
- 不同版本HTTP协议区别


### 缓存策略

- 强缓存
  - cache-control
  - expires
- 协商缓存
  - etag / if-match
  - last-modify / if-modified-sinced


### 页面渲染

主要流程:
- 解析HTML: 解析 HTML 并构建 DOM 树。
- 解析CSS: 解析 CSS 构建 CSSOM 树（样式树）。 
- 合成渲染树：将 DOM 与 CSSOM 合并成一个 渲染树 （Render Tree） 。
- 布局计算：根据渲染树的结构，计算每个节点在屏幕上的大小、位置等属性，生成布局信息（Layout）。这个过程会发生回流和重绘。
- 绘制页面：将生成的布局信息交给浏览器的绘图引擎，通过 GPU 加速将像素绘制（Paint）到屏幕上。

**浏览器回流和重绘**
如果页面发生改变，浏览器需要重新计算布局和绘制，这可能会导致性能问题。因此我们应尽量避免频繁的 DOM 操作和调整元素样式，以减少不必要的回流和重绘。