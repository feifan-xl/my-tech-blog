


### fiber

react 中用于提高 渲染性能和可扩展性的一种架构 
- 增量渲染和时间切片
- 优先级调度
- 并发模式和异步加载等(concurrent mode & suspence)

本质是一个任务调和器  

核心思想是将渲染过程拆分为多个可中断可恢复的任务，允许react更加灵活的管理和更新ui


*核心*
RIC: window.requestIdleCallback() 方法将在浏览器的空闲时段内调用的函数排队


实现
1. render 阶段: 构建Fiber对象(DFS)，构建链表，在链表中标记要执行的DOM操作，可中断
2. commit 阶段: 根据构建好的链表进行DOM操作，不可终端  


#### 基本概念 

Fiber: 是一种描述组件树的数据结构，代表了可中断可恢复的渲染任务

Fiber 节点是一个 JavaScript 对象，用于描述组件树的结构和状态
  - 包含了与组件相关的信息，如类型、props、state、效果标记（effect tag）等
  - 包含了指向其子节点、兄弟节点和父节点的引用，以构建组件树的层级结构
  


#### 更新过程 

1. 触发更新：组件状态或属性发生变化时，调用更新函数，更新状态
2. 生成新的vdom：
3. 协调新旧dom树: 使用协调算法比较新旧两个树，找出需要更新的部分
4. 执行更新： 

采用增量渲染方式，协调过程分解为多个小任务，并使用任务调度器（Scheduler）来动态地调度这些任务，还引入了一下方式:
  - 实现时间切片(分片)
  - 可中断渲染(优先级)

#### 双缓存策略

用于管理更新阶段的一种机制  
通过在内存中维护两份 UI 状态，一份用于渲染当前帧，另一份用于计算下一帧的状态
避免了直接在 DOM 上进行更新操作，从而提高了流畅性


#### 时间切片 

- 将任务分解为小片
- 放入到任务队列中
- 通过剩余执行时间检查，去执行任务
- 并根据不同优先级进行调度 

*优先级*
同步任务：最高优先级的任务，通常用于处理用户交互事件和页面加载过程中的同步操作。
异步任务：中等优先级的任务，包括普通的更新任务和网络请求等异步操作。
空闲任务：最低优先级的任务，通常用于执行一些不紧急的任务，如日志记录或统计信息收集等。


#### 并发模式 

concurrent mode: 允许 react 在不同任务间进行切换， 主要指优先级，从而优化用户体验 





### why not vue

响应式原理不同, react需要调用setState方法，而vue直接修改变量就行

vue更加精确  
react整个组件都需要重新渲染 父组件的状态更新了，所有的子组件得跟着一起渲染 

